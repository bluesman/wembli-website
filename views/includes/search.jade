//- set up some string vars to be used in this template
heading       = 'Upcoming Events';
url           = '/search/events/';
seeMore       = 'See more events';
lastEventDate = '';
lastEventId   = undefined;
- if ((typeof events != "undefined") && (typeof events[0] !== "undefined"))
	- lastEventDate = new Date(events[events.length-1].Date).format('mm-dd-yy');
	- lastEventId = events[events.length-1].ID;
- if (req.session.visitor.tracking.city)
	- heading += ' Near '+req.session.visitor.tracking.city;
	- url     += req.session.visitor.tracking.city+'/';
	- seeMore += ' near '+req.session.visitor.tracking.city;

- if (search)
	- heading = 'Events matching "'+search+'"'
	- seeMore = 'See more events matching "'+search+'"'
	- var placeholder = search
	- url = '/search/events/' + search + '/';
- else
	- var search = "";
	- var placeholder = 'Enter an event, team or venue...'
- url += Date.today().format("mm-dd-yy")
#search-frame(ng-controller="SearchCtrl")
	input(type="hidden", name="search", value="#{search}", ng-init="search='#{search}'")
	input(type="hidden", name="city", value="#{req.session.visitor.tracking.city}", ng-init="city='#{req.session.visitor.tracking.city}'")
	input(type="hidden", name="postalCode", value="#{req.session.visitor.tracking.postalCode}", ng-init="postalCode='#{req.session.visitor.tracking.postalCode}'")
	input(type="hidden", name="lastEventDate", ng-init="lastEventDate='#{lastEventDate}'", value="#{lastEventDate}")
	input(type="hidden", name="lastEventId", ng-init="lastEventId='#{lastEventId}'", value="#{lastEventId}")
	.container.clearfix
		#search-left.left.pull-left
			.search-arrow
			.copy.segoe Search for the event you want to go to...
			.wembliman
		#search-right.right.pull-left
			.search
				form#index-search-form.form-search.clearfix(method="GET", action="/search/events", ng-submit="submitSearch()")
					i.icon-search.icon-2x.pull-left(ng-hide="searchInProgress")
					i.icon-cog.icon-spin.icon-2x.pull-left(ng-show="searchInProgress")
					input#query.pull-left(type="text", ng-model="search", name="search", placeholder="enter an event, team or venue, city or zip code")
					button.btn.btn-secondary.segoe.pull-left(href="#") search
			.results(ng-controller="EventListCtrl")
				if (typeof partial != "undefined")
					include ../partials/includes/event-list
				else
					if ((typeof events !== "undefined") && (typeof events[0] !== "undefined"))
						include event-list
						.hide(ng-init="noMoreEvents=false")
				.no-results(ng-show="noMoreEvents")
					.notify-email(type="search")
						.collect-email(ng-hide="emailCollected")
							p Aww shucks! We haven't got any more event listings to show you.  Enter your email below if you'd like to be notified when events become available.
							fieldset
								input#email
						.collected-email(ng-show="emailCollected")
							p OK! We'll let you know if any events become available!
						.clearfix
							.back-to-search.pull-left
								a(href="/search") << Perform a new search
							button.btn.btn-primary.pull-right(ng-hide="emailCollected",ng-click="collectEmail()") Notify Me!

				a#more-events(ng-click="moreEvents()",ng-hide="noMoreEvents")
					span= seeMore
					i.icon-chevron-down
