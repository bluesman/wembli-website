/*! wembli-website 2014-08-07 */
"use strict";angular.module("wembliApp",["ngRoute","ngAnimate","mgcrea.ngStrap","wembliApp.controllers","wembliApp.controllers.dashboard","wembliApp.controllers.header","wembliApp.filters","wembliApp.services","wembliApp.services.header","wembliApp.services.facebook","wembliApp.services.twitter","wembliApp.services.pixel","wembliApp.directives","wembliApp.directives.header","wembliApp.directives.dashboard"]).config(["$routeProvider","$locationProvider",function(){}]).run(["$timeout","initRootScope","$rootScope","$location","$route","$window","facebook","twitter","plan","wembliRpc",function(a,b,c,d,e,f,g,h,i){console.log("run dashboard angular app"),a(function(){i.fetch(function(){})}),f.fbAsyncInit=function(){g.getLoginStatus(),c.facebook=g},h.getLoginStatus()}]),angular.module("wembliApp.controllers.dashboard",[]).controller("DashboardMainCtrl",["$rootScope","$scope","$location","plan",function(a,b,c,d){b.showList=c.url(),console.log(b.showList),b.deletePlan=function(a){console.log("delete plan: "+a),d.deactivate({guid:a},function(c,d){console.log(d),b.dashboard.organizer.map(function(a){console.log("plan in map: "),console.log(a)});for(var e=[],f=0;f<b.dashboard.organizer.length;f++)b.dashboard.organizer[f].guid!==a&&e.push(b.dashboard.organizer[f]);b.dashboard.organizer=e,console.log(b.dashboard.organizer)})}}]).controller("DashboardSettingsCtrl",["$rootScope","$scope","$location","wembliRpc","plan",function(a,b,c,d){b.showDetail=c.url(),b.submitInProgress=!1,b.changePassword=function(){if(b.changePasswordForm.$valid){b.submitInProgress=!0;var a={password:b.changePassword.password,password2:b.changePassword.password2};d.fetch("customer.changePassword",a,function(a,c){console.log(c),b.submitInProgress=!1,b.changePasswordForm.error=c.formError,b.changePasswordForm.mismatch=c.passwordMismatch,b.changePasswordForm.tooShort=c.passwordTooShort,b.changePasswordForm.error||(b.changePasswordForm.success=!0)})}}}]).controller("DashboardPaymentsCtrl",["$rootScope","$scope","$window","$location","plan","customer","wembliRpc",function(a,b,c,d,e,f,g){b.showDetail=d.url(),b.submitInProgress=!1,console.log(b.showDetail),b.$on("bank-account-created",function(){c.location.href="/dashboard/payment-information"}),b.addCreditCard=function(){if(!b.submitInProgress){b.submitInProgress=!0,b.error=b.formError=b.success=!1;var d={};d.cardHolderName=b.creditCard.cardHolderName,d.creditCardNumber=b.creditCard.creditCardNumber,d.expirationDateMonth=b.creditCard.expirationDateMonth,d.expirationDateYear=b.creditCard.expirationDateYear,d.cvv=b.creditCard.cvv,d.postalCode=b.creditCard.postalCode,g.fetch("customer.createCreditCard",d,function(d,e){return console.log(e),b.submitInProgress=!1,d?(b.error=!0,b.errorMessage=d,void(b.success=!1)):e.success?(b.success=!0,a.$broadcast("credit-card-created",e.friend),void(c.location.href="/dashboard/payment-information")):(b.error=!0,b.success=!1,void(b.errorMessage=e.error))})}},b.deleteAccount=function(){b.submitInProgress=!0,g.fetch("customer.deleteBankAccount",{},function(a,b){console.log(b),a&&alert("something bad happened contact help@wembli.com"),c.location.href="/dashboard/payment-information"})},b.deleteCard=function(){b.submitInProgress=!0,g.fetch("customer.deleteCreditCard",{},function(a,b){console.log(b),a&&alert("something bad happened contact help@wembli.com"),c.location.href="/dashboard/payment-information"})}}]),angular.module("wembliApp.directives.dashboard",[]).directive("dashboard",["customer","$rootScope","wembliRpc","$location",function(a,b,c){return{restrict:"C",compile:function(){return function(d){d.$on("customer-changed",function(){d.customer=a.get(),d.noValidBankAccounts=!0,"undefined"!=typeof d.customer.balancedAPI&&"undefined"!=typeof d.customer.balancedAPI.bankAccounts&&angular.forEach(d.customer.balancedAPI.bankAccounts.items,function(a){a.is_valid&&(d.needBankAccountInfo=!1)}),"undefined"!=typeof d.customer.balancedAPI&&"undefined"!=typeof d.customer.balancedAPI.creditCards&&angular.forEach(d.customer.balancedAPI.creditCards.items,function(a){a.is_valid&&(d.needCreditCardInfo=!1)})}),c.fetch("dashboard.init",{},function(c,e){return c?void alert("error happened - contact help@wembli.com"):(("undefined"==typeof e.customer.balancedAPI||"undefined"==typeof e.customer.balancedAPI.creditCards||"undefined"==typeof e.customer.balancedAPI.creditCards.items[0])&&(d.needCreditCardInfo=!0),("undefined"==typeof e.customer.balancedAPI||"undefined"==typeof e.customer.balancedAPI.bankAccounts||"undefined"==typeof e.customer.balancedAPI.bankAccounts.items[0])&&(d.needBankAccountInfo=!0),d.dashboard=e,a.set(e.customer),console.log(e),void b.$broadcast("dashboard-fetched",e))})}}}}]).directive("updateCustomerInfoButton",["$rootScope",function(a){return{restrict:"C",replace:!1,cache:!1,compile:function(){return function(b,c){c.click(function(){a.$broadcast("dashboard-updateCustomerInfo",{})})}}}}]).directive("updateCustomerInfo",["customer","wembliRpc","$rootScope","$location",function(a,b,c,d){return{restrict:"C",replace:!1,cache:!1,compile:function(){return function(c){c.$on("dashboard-updateCustomerInfo",function(){c.customer=a.get()}),c.updateCustomerInfo=function(){var a={name:c.customer.balancedAPI.customerAccount.name,email:c.customer.balancedAPI.customerAccount.email,meta:c.customer.balancedAPI.customerAccount.meta,ssn_last4:c.customer.balancedAPI.customerAccount.ssn_last4,business_name:c.customer.balancedAPI.customerAccount.business_name,address:c.customer.balancedAPI.customerAccount.address,phone:c.customer.balancedAPI.customerAccount.phone,dob:c.customer.balancedAPI.customerAccount.dob,ein:c.customer.balancedAPI.customerAccount.ein,facebook:c.customer.balancedAPI.customerAccount.facebook,twitter:c.customer.balancedAPI.customerAccount.twitter};b.fetch("customer.updateAccountHolderInfo",a,function(a){a&&alert("something bad happened contact help@wembli.com"),d.hash("#payment-information"),$("#edit-customer-account").modal("hide")},function(a){return a},function(a){return JSON.parse(a)})}}}}}]).directive("addBankAccount",["customer","wembliRpc","$rootScope","$location",function(a,b,c,d){return{restrict:"C",replace:!1,cache:!1,compile:function(){return function(a){a.addBankAccount=function(){var c={name:a.addBankAccount.accountName,accountNumber:a.addBankAccount.accountNumber,routingNumber:a.addBankAccount.routingNumber,type:a.addBankAccount.accountType};b.fetch("customer.addBankAccount",c,function(a){a&&alert("something bad happened contact help@wembli.com"),d.hash("#payment-information"),$("#add-bank-account").modal("hide")},function(a){return a},function(a){return JSON.parse(a)})}}}}}]).directive("deleteBankAccountButton",["$rootScope",function(a){return{restrict:"C",replace:!1,cache:!1,compile:function(){return function(b,c,d){d.$observe("uri",function(b){c.click(function(){a.$broadcast("dashboard-setBankAccountUri",{uri:b})})})}}}}]).directive("activityFeed",[function(){return{restrict:"E",replace:!0,cache:!1,templateUrl:"/partials/activity-feed",compile:function(){}}}]).directive("deleteBankAccount",["customer","wembliRpc","$rootScope","$location",function(){return{restrict:"C",replace:!1,cache:!1,compile:function(){return function(a){a.$on("dashboard-setBankAccountUri",function(b,c){a.bankAccountUri=c.uri})}}}}]);