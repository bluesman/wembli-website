/*! wembli-website 2013-12-29 */
"use strict";angular.module("wembliApp",["ngRoute","wembliApp.controllers","wembliApp.controllers.login","wembliApp.controllers.header","wembliApp.filters","wembliApp.services","wembliApp.services.header","wembliApp.services.facebook","wembliApp.services.twitter","wembliApp.services.pixel","wembliApp.directives","wembliApp.directives.header"]).config(["$routeProvider","$locationProvider",function(){}]).run(["$timeout","initRootScope","$rootScope","$location","$route","$window","facebook","twitter","plan","wembliRpc",function(a,b,c,d,e,f,g,h,i){console.log("run login angular app"),a(function(){i.fetch(function(){})}),f.fbAsyncInit=function(){g.getLoginStatus(),c.facebook=g},h.getLoginStatus()}]),angular.module("wembliApp.controllers.login",[]).controller("SupplyPasswordCtrl",["$scope","wembliRpc","$window",function(a,b,c){a.confirmPasswordForm={},a.confirmPasswordForm.passwordMismatch=!1,a.confirmPasswordForm.fatalError=!1,a.confirmPasswordInProgress=!1,a.email=$("#email").val(),a.token=$("#token").val(),a.redirectUrl=$("#redirectUrl").val(),a.submitConfirmPasswordForm=function(){a.confirmPasswordForm.$invalid||(a.confirmPasswordInProgress=!0,console.log(a.email),b.fetch("customer.resetPassword",{email:a.email,token:a.token,password:a.password,password2:a.password2},function(b,d){return console.log(b),console.log(d),b?(console.log("fatal err"),a.confirmPasswordForm.fatalError=b,a.confirmPasswordInProgress=!1,void 0):(d.passwordMismatch?(a.confirmPasswordForm.passwordMismatch=d.passwordMismatch,a.confirmPasswordInProgress=!1):(a.confirmPasswordInProgress=!1,c.location.href=a.redirectUrl?a.redirectUrl:"/dashboard"),void 0)}))}}]).controller("SignupCtrl",["$scope","$window","wembliRpc","pixel","googleAnalytics",function(a,b,c,d,e){a.signupForm={},a.signupForm.exists=!1,a.signupForm.fatalError=!1,a.signupInProgress=!1,a.submitSignupForm=function(){a.signupForm.$invalid||(a.signupInProgress=!0,c.fetch("customer.signup",{firstName:a.firstName,lastName:a.lastName,email:a.email},function(c,f){if(c)return console.log("fatal err"),a.signupForm.fatalError=c,a.signupInProgress=!1,void 0;if(f.exists)a.signupForm.exists=f.exists,a.signupInProgress=!1;else{var g=e.getCookie();d.fire({type:"signup",campaign:g.__utmz.utmccn,source:"google",medium:g.__utmz.utmcmd,term:g.__utmz.utmctr,content:"1070734106"}),d.fire({type:"signup",campaign:"Signup Conversion Pixel Facebook Ad",source:"facebook",medium:"cpc",term:"",content:"6013588786171"}),a.signupInProgress=!1,b.location.href=a.redirectUrl?a.redirectUrl:"/dashboard"}}))}}]).controller("LoginCtrl",["$scope","$window","wembliRpc",function(a,b,c){a.loginForm={},a.loginForm.invalidCredentials=!1,a.forgotPasswordForm={},a.forgotPasswordForm.noCustomer=!1,a.forgotPasswordForm.success=!1,a.forgotPasswordInProgress=!1,a.loginInProgress=!1,a.rememberEmail&&(a.loginForm.email=a.rememberEmail,a.loginForm.remember=!0),a.submitLoginForm=function(){return a.loginForm.$invalid?(console.log("login form is not valid"),void 0):(a.loginInProgress=!0,a.loginForm.remember,c.fetch("customer.login",{email:a.email,password:a.password},function(c,d){return a.loginInProgress=!1,c?(console.log("fatal err"),a.loginForm.fatalError=c,void 0):(d.error?a.loginForm.invalidCredentials=!0:b.location.href=a.redirectUrl?a.redirectUrl:"/dashboard",void 0)}),void 0)},a.submitForgotPasswordForm=function(){a.forgotPasswordForm.$invalid||(a.forgotPasswordInProgress=!0,c.fetch("customer.sendForgotPasswordEmail",{email:a.email},function(b,c){return a.forgotPasswordInProgress=!1,b?(a.forgotPasswordForm.fatalError=b,void 0):(c.error?a.forgotPasswordForm.noCustomer=!0:a.submitForgotPasswordForm.success=!0,void 0)}))}}]);