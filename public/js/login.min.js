/*! wembli-website 2014-08-09 */
"use strict";angular.module("wembliApp",["ngRoute","ngAnimate","mgcrea.ngStrap","wembliApp.controllers","wembliApp.controllers.login","wembliApp.controllers.header","wembliApp.filters","wembliApp.services","wembliApp.services.header","wembliApp.services.facebook","wembliApp.services.twitter","wembliApp.services.pixel","wembliApp.directives","wembliApp.directives.header"]).config(["$routeProvider","$locationProvider",function(){}]).run(["$timeout","initRootScope","$rootScope","$location","$route","$window","facebook","twitter","plan","wembliRpc",function(a,b,c,d,e,f,g,h,i){console.log("run login angular app"),a(function(){i.fetch(function(){})}),f.fbAsyncInit=function(){g.getLoginStatus(),c.facebook=g},h.getLoginStatus()}]),angular.module("wembliApp.controllers.login",[]).controller("RsvpLoginCtrl",["$scope","plan","customer","wembliRpc","pixel","googleAnalytics","$window",function(a,b,c,d,e,f,g){a.listId="a55323395c",a.$watch("service",function(b){"undefined"!==b&&(console.log(b),"wemblimail"===b?d.fetch("friend.getServiceId",{token:a.token},function(b,c){c.serviceId&&(a.email=c.serviceId)}):(a.customer&&"twitter"===b||"facebook"===b)&&(a.confirmSocial=b,console.log("confirmSocial: "+a.confirmSocial)))}),a.$watch("guid",function(){a.next="/rsvp/"+a.guid+"/"+a.token+"/"+a.service,console.log("next: "+a.next)}),a.confirm=function(b){return"undefined"==typeof b?a.customer&&"twitter"!==a.service&&"facebook"!==a.service?!0:!1:b===a.service?!0:!1},a.$on("forgot-password-email-sent",function(b,c){c?a.forgotPasswordEmailError=!0:(a.forgotPasswordEmailError=!1,a.forgotPasswordEmailSent=!0)}),a.showSignupForm=!0,a.inProgress=!1,a.showForm=function(b,c){a[b]=!0,a[c]=!1},a.submitSignup=function(){if(a.forgotPasswordEmailError=!1,a.forgotPasswordEmailSent=!1,a.signup.$valid){a.inProgress=!0;var b={firstName:a.firstName,lastName:a.lastName,email:a.email,next:a.next,listId:a.listId};d.fetch("customer.signup",b,function(b,d){if(console.log("back from customer signup"),console.log(d),d.exists&&!d.noPassword)return console.log("account exists and has password"),a.login.accountExists=!0,a.showForm("showLoginForm","showSignupForm");if(d.noPassword)return console.log("no password"),a.showForm("showLoginUnconfirmedForm","showSignupForm");if(d.formError)return void(a.signup.formError=!0);a.customer=c.get();var h={facebook:!0,twitter:!0};"undefined"!=typeof h[a.service]&&h[a.service]&&(a.confirmSocial=a.service),a.signup.success=!0,console.log("submit signup succes - fire pixel");var i=f.getCookie();return e.fire({type:"signup",campaign:i.__utmz.utmccn,source:"google",medium:i.__utmz.utmcmd,term:i.__utmz.utmctr,content:"1070734106"}),e.fire({type:"signup",campaign:"Signup Conversion Pixel Facebook Ad",source:"facebook",medium:"cpc",term:"",content:"6013588786171"}),a.confirmSocial?void 0:(console.log("navigate to: "+a.next),g.location.href=a.next)})}},a.submitLogin=function(){if(a.forgotPasswordEmailError=!1,a.forgotPasswordEmailSent=!1,a.login.$valid){var b={email:a.email,password:a.password};d.fetch("customer.login",b,function(b,c){return c.noPassword?a.showForm("showLoginUnconfirmedForm","showLoginForm"):c.invalidCredentials?void(a.login.invalidCredentials=!0):(a.login.success=!0,g.location.href=a.next)})}}}]).controller("SupplyPasswordCtrl",["$scope","wembliRpc","$window",function(a,b,c){a.confirmPasswordForm={},a.confirmPasswordForm.passwordMismatch=!1,a.confirmPasswordForm.fatalError=!1,a.confirmPasswordInProgress=!1,a.email=$("#email").val(),a.token=$("#token").val(),a.redirectUrl=$("#redirectUrl").val(),console.log("redirecturl: "+a.redirectUrl),a.submitConfirmPasswordForm=function(){a.confirmPasswordForm.$invalid||(a.confirmPasswordInProgress=!0,console.log(a.email),b.fetch("customer.resetPassword",{email:a.email,token:a.token,password:a.password,password2:a.password2},function(b,d){return console.log(b),console.log(d),b?(console.log("fatal err"),a.confirmPasswordForm.fatalError=b,void(a.confirmPasswordInProgress=!1)):void(d.passwordMismatch?(a.confirmPasswordForm.passwordMismatch=d.passwordMismatch,a.confirmPasswordInProgress=!1):(a.confirmPasswordInProgress=!1,console.log("supplied password - redirect to: "+a.redirectUrl),c.location.href=a.redirectUrl?a.redirectUrl:"/dashboard"))}))}}]).controller("SignupCtrl",["$scope","$window","wembliRpc","pixel","googleAnalytics",function(a,b,c,d,e){a.signupForm={},a.signupForm.exists=!1,a.signupForm.fatalError=!1,a.signupInProgress=!1,a.submitSignupForm=function(){a.signupForm.$invalid||(a.signupInProgress=!0,c.fetch("customer.signup",{firstName:a.firstName,lastName:a.lastName,email:a.email},function(c,f){if(c)return console.log("fatal err"),a.signupForm.fatalError=c,void(a.signupInProgress=!1);if(f.exists)a.signupForm.exists=f.exists,a.signupInProgress=!1;else{var g=e.getCookie();d.fire({type:"signup",campaign:g.__utmz.utmccn,source:"google",medium:g.__utmz.utmcmd,term:g.__utmz.utmctr,content:"1070734106"}),d.fire({type:"signup",campaign:"Signup Conversion Pixel Facebook Ad",source:"facebook",medium:"cpc",term:"",content:"6013588786171"}),a.signupInProgress=!1,b.location.href=a.redirectUrl?a.redirectUrl:"/dashboard"}}))}}]).controller("LoginCtrl",["$scope","$window","wembliRpc",function(a,b,c){a.loginForm={},a.loginForm.invalidCredentials=!1,a.forgotPasswordForm={},a.forgotPasswordForm.noCustomer=!1,a.forgotPasswordForm.success=!1,a.forgotPasswordInProgress=!1,a.loginInProgress=!1,a.rememberEmail&&(a.loginForm.email=a.rememberEmail,a.loginForm.remember=!0),a.submitLoginForm=function(){return a.loginForm.$invalid?void console.log("login form is not valid"):(a.loginInProgress=!0,a.loginForm.remember,void c.fetch("customer.login",{email:a.email,password:a.password},function(c,d){return a.loginInProgress=!1,c?(console.log("fatal err"),void(a.loginForm.fatalError=c)):void(d.error?a.loginForm.invalidCredentials=!0:b.location.href=a.redirectUrl?a.redirectUrl:"/dashboard")}))},a.submitForgotPasswordForm=function(){a.forgotPasswordForm.$invalid||(a.forgotPasswordInProgress=!0,c.fetch("customer.sendForgotPasswordEmail",{email:a.email},function(b,c){return a.forgotPasswordInProgress=!1,b?void(a.forgotPasswordForm.fatalError=b):void(c.error?a.forgotPasswordForm.noCustomer=!0:a.forgotPasswordForm.success=!0)}))}}]);