/*! wembli-website 2014-10-10 */
"use strict";angular.module("wembliApp",["ngRoute","ngAnimate","mgcrea.ngStrap","wembliApp.controllers","wembliApp.controllers.addOns","wembliApp.controllers.header","wembliApp.filters","wembliApp.services","wembliApp.services.header","wembliApp.services.facebook","wembliApp.services.twitter","wembliApp.services.pixel","wembliApp.services.google","wembliApp.services.addOns","wembliApp.directives","wembliApp.directives.header","wembliApp.directives.addOns"]).config(["$routeProvider","$locationProvider",function(){}]).run(["$timeout","initRootScope","$rootScope","$location","$route","$window","facebook","twitter","plan","wembliRpc","overlay",function(a,b,c,d,e,f,g,h,i,j,k){console.log("run addOns angular app"),k.loading(!0),k.show(),a(function(){i.fetch(function(){})}),f.fbAsyncInit=function(){g.getLoginStatus(),c.facebook=g},h.getLoginStatus()}]),angular.module("wembliApp.controllers.addOns",[]).controller("HotelsCtrlOff",["$rootScope","$scope","$timeout","plan","wembliRpc","googleMap","mapInfoWindowContent","loadingModal",function(a,b,c,d,e,f,g,h){function i(a){f.isDrawn(!1);var d=a.venue.data.geocode.geometry.location.lat,i=a.venue.data.geocode.geometry.location.lng,j=new google.maps.Marker({map:f.getMap(),position:new google.maps.LatLng(d,i)});j.setIcon("/images/icons/map-icons/sports/stadium.png"),j.setAnimation(google.maps.Animation.DROP);var k=new google.maps.InfoWindow({content:g.create({header:a.event.eventVenue,body:a.venue.data.Street1+", "+a.event.eventCity+", "+a.event.eventState}),pixelOffset:new google.maps.Size(10,0)});google.maps.event.addListener(j,"click",function(){f.isInfoWindowOpen(j)?f.closeInfoWindow(j):f.openInfoWindow(j)}),f.addMarker(j),f.addInfoWindow(k,j),f.openInfoWindow(j);var l={location:new google.maps.LatLng(d,i),radius:1500,types:["lodging"]},m=new google.maps.places.PlacesService(f.getMap());m.nearbySearch(l,function(a,c){c==google.maps.places.PlacesServiceStatus.OK&&b.$apply(function(){b.googleHotels=a})}),e.fetch("event.getHotels",{lat:d,lng:i},function(a,d){if(a)return void alert("error happened - contact help@wembli.com");c(function(){b.$apply(function(){b.hotels=d.hotels})});var e=0,f=600,g=function(){$("#price-slider").slider("option","values")};$("#price-slider").slider({range:!0,min:e,max:f,step:5,values:[e,f],slide:function(a,b){$("#amount").val("$"+b.values[0]+" - $"+b.values[1])},stop:function(){g()}});var i="$"+$("#price-slider").slider("values",0)+" - $"+$("#price-slider").slider("values",1);$("#amount").val(i),$("#quantity-filter").change(function(){g()}),h.hide()},function(a){return a},function(a){return JSON.parse(a)})}h.show("Finding hotels...",null),b.determineRange=function(a){var b=parseFloat(a);return 20>=b?"$":b>20&&50>=b?"$$":b>50?"$$$":void 0},b.notFound=!0,b.$watch("hotels",function(a){a&&c(function(){angular.forEach(a.listing,function(a){if(!f.hasMarker(a.lat,a.lng)){var b=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),map:f.getMap()});b.setIcon("/images/icons/map-icons/entertainment/hotel_0star.png"),b.setAnimation(google.maps.Animation.DROP);var c=new google.maps.InfoWindow({content:g.create({header:a.location_name,body:a.address+", "+a.city}),pixelOffset:new google.maps.Size(10,0)});google.maps.event.addListener(b,"click",function(){f.isInfoWindowOpen(b)?f.closeInfoWindow(b):f.openInfoWindow(b)}),f.addMarker(b),f.addInfoWindow(c,b)}})})});var j=b.$watch("googleHotels",function(a){a&&c(function(){angular.forEach(a,function(a){var b=new google.maps.Marker({map:f.getMap(),position:a.geometry.location});b.setIcon("/images/icons/map-icons/entertainment/hotel_0star.png"),b.setAnimation(google.maps.Animation.DROP);var c=new google.maps.InfoWindow({content:g.create({header:a.name,body:a.vicinity}),pixelOffset:new google.maps.Size(10,0)});google.maps.event.addListener(b,"click",function(){f.isInfoWindowOpen(b)?f.closeInfoWindow(b):f.openInfoWindow(b)}),f.addMarker(b),f.addInfoWindow(c,b)}),j()})});d.get(function(c){if(b.context=d.getContext()||"visitor",b.backToPlan=!0,0==d.getFriends().length&&(b.backToPlan=!1),"friend"===b.context&&(b.backToPlan=!0),f.isDrawn())i(c);else var e=a.$on("google-map-drawn",function(){i(c),e()})})}]).controller("HotelsCtrl",["$rootScope","$scope","$timeout","plan","wembliHotels","wembliRpc","googleMap","googlePlaces","mapVenue","mapMarker","mapInfoWindowContent","overlay","$location","$window","googleAnalytics","header",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){p.fixed(),g.init(),b.currentPath=m.path(),b.addonsFetched=0,b.filteredList=!1,b.notFound=!0,b.parseDate=function(a){return new Date(a)},b.determineDistance=function(a){return parseFloat(a/5280).toFixed(2)};var q=function(){b.filteredList=!1,c(function(){b.$apply(function(){for(var a=0;a<b.hotels.length;a++)b.hotels[a].hide=!1})})};b.filterNone=q;var r=function(a){return b.filteredList=!0,"undefined"==typeof a?q():void b.$apply(function(){for(var c=0;c<b.hotels.length;c++)b.hotels[c].hide=b.hotels[c].id!=a})},s=function(a){b.notFound=!1,"undefined"!=typeof a&&angular.forEach(a,function(a,b){a.service="yipit",a.hide="undefined"==typeof a.hide?!1:a.hide,a.inPlan=!1;var c=d.getHotels();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"yipit"===e.hotel.service&&e.hotel.id==a.id&&(a._id=e._id,a.purchased=e.purchased,a.inPlan=!0)}g.hasMarker(a.business.locations[0].lat,a.business.locations[0].lon)||j.create(g,{icon:"/images/icons/map-icons/entertainment/hotel_0star.png",lat:a.business.locations[0].lat,lng:a.business.locations[0].lon,name:a.title,body:a.business.name,click:{on:function(){r(a.id)},off:function(){r()}}})})},t=function(a){b.notFound=!1,"undefined"!=typeof a&&(console.log(a),angular.forEach(a,function(a,b){a.service="google",a.hide="undefined"==typeof a.hide?!1:a.hide,a.inPlan=!1;var c=d.getHotels();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"google"===e.hotel.service&&e.hotel.id==a.id&&(a._id=e._id,a.inPlan=!0)}g.hasMarker(a.geometry.location.lat(),a.geometry.location.lng())||j.create(g,{icon:"/images/icons/map-icons/entertainment/hotel_0star.png",position:a.geometry.location,name:a.name,body:a.vicinity})}))};b.$on("hotels-changed",function(){c(function(){return s(b.hotels)}),c(function(){return t(b.googleHotels)})}),b.$watch("hotels",function(a){a&&c(function(){return s(a)})}),b.$watch("googleHotels",function(a){a&&c(function(){return t(a)})}),b.$watch("addonsFetched",function(a){a&&a>0&&(b.addonsFetched=0,l.loading(!1),l.hide())});var u=function(a){var c=a.venue.data.geocode.geometry.location.lat,d=a.venue.data.geocode.geometry.location.lng;$(".addons-list-col").css("height",$(n).height()-108),i.create(g,{lat:c,lng:d,name:a.event.eventVenue,street:a.venue.data.Street1,city:a.event.eventCity,state:a.event.eventState}),e.fetchGoogleHotels({lat:c,lng:d},function(a,c){b.$apply(function(){b.googleHotels=c,b.addonsFetched++})})},v=function(a){var c={};"yipit"!==a.service&&(c.receipt={"not-available":!0}),f.fetch("plan.addHotel",{service:a.service,eventId:d.get().event.eventId,hotel:a,total:0,payment:JSON.stringify(c)},function(c,d){console.log("added hotel:"),console.log(c,d),a._id=d.hotel._id,a.inPlan=!0,b.currentHotel=a,"split-first"===b.plan.preferences.payment?(b.hotelConfirm=!0,l.show()):(b.hotelConfirm=!0,l.show())})};b.addHotel=function(a){var c=b.hotels[a];console.log(c),delete c.$$hashKey,v(c)},b.addGoogleHotel=function(a){var c=b.googleHotels[a];delete c.$$hashKey,h.getDetails(c.reference,function(a,d){d==google.maps.places.PlacesServiceStatus.OK&&b.$apply(function(){b.hotelDetails=a,v(c)})})},b.removeHotel=function(c){return"undefined"==typeof c&&(c=b.currentHotel._id),c?void d.removeHotel({hotelId:c},function(c,e){b.currentHotel&&delete b.currentHotel,b.buyHotelOffsite&&(b.buyHotelOffsite=!1,l.hide()),b.hotelConfirm&&(b.hotelConfirm=!1,l.hide()),d.setHotels(e.hotel),a.$broadcast("hotels-changed")}):(b.hotelConfirm=!1,b.buyHotelOffsite=!1,void l.hide())},b.boughtHotel=function(){return"undefined"==typeof b.currentHotel?void(n.location.href=b.nextLink):void d.addHotelReceipt({hotelId:b.currentHotel._id,service:b.currentHotel.service,receipt:{qty:b.currentHotel.selectedQty,amountPaid:b.currentHotel.amountPaid}},function(){o.trackEvent("Plan","boughtHotel",b.plan.event.eventName,"",function(){n.location.href=b.nextLink})})},a.$on("overlay-clicked",function(){b.removeHotel(b.currentHotel._id)}),d.get(function(c){if(b.context=d.getContext()||"visitor",b.backToPlan=!1,null!==c.organizer.rsvp.decision&&(b.backToPlan=!0),b.nextLink=b.backToPlan?"/plan/cart":"/event-options/"+c.event.eventId+"/"+c.event.eventName,b.nextText=b.backToPlan?"Ok, Back To Plan Dashboard":"Continue To Plan Preferences","/plan/cart"===b.nextLink&&"organizer"!==d.getContext()&&(b.nextLink="/plan/vote"),"friend"===b.context&&(b.backToPlan=!0),g.isDrawn())u(c);else var e=a.$on("google-map-drawn",function(){u(c),e()})})}]).controller("RestaurantsCtrl",["$rootScope","$scope","$timeout","plan","wembliRestaurants","wembliRpc","googleMap","googlePlaces","mapVenue","mapMarker","mapInfoWindowContent","overlay","$location","$window","googleAnalytics","header",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){p.fixed(),g.init(),b.currentPath=m.path(),b.addonsFetched=0,b.filteredList=!1,b.notFound=!0,b.parseDate=function(a){return new Date(a)},b.determineDistance=function(a){return parseFloat(a/5280).toFixed(2)};var q=function(){b.filteredList=!1,c(function(){b.$apply(function(){for(var a=0;a<b.deals.length;a++)b.deals[a].hide=!1})})};b.filterNone=q;var r=function(a){return b.filteredList=!0,"undefined"==typeof a?q():void b.$apply(function(){for(var c=0;c<b.deals.length;c++)b.deals[c].hide=b.deals[c].id!=a})},s=function(a){b.notFound=!1,"undefined"!=typeof a&&angular.forEach(a,function(a,b){a.service="yipit",a.hide="undefined"==typeof a.hide?!1:a.hide,a.inPlan=!1;var c=d.getRestaurants();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"yipit"===e.restaurant.service&&e.restaurant.id==a.id&&(a._id=e._id,a.purchased=e.purchased,a.inPlan=!0)}g.hasMarker(a.business.locations[0].lat,a.business.locations[0].lon)||j.create(g,{icon:"/images/icons/map-icons/entertainment/restaurant.png",lat:a.business.locations[0].lat,lng:a.business.locations[0].lon,name:a.title,body:a.business.name,click:{on:function(){r(a.id)},off:function(){r()}}})})},t=function(a){b.notFound=!1,"undefined"!=typeof a&&angular.forEach(a,function(a,b){a.service="google",a.hide="undefined"==typeof a.hide?!1:a.hide,a.inPlan=!1;var c=d.getRestaurants();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"google"===e.restaurant.service&&e.restaurant.id==a.id&&(a._id=e._id,a.inPlan=!0)}g.hasMarker(a.geometry.location.lat(),a.geometry.location.lng())||j.create(g,{icon:"/images/icons/map-icons/entertainment/restaurant.png",position:a.geometry.location,name:a.name,body:a.vicinity})})};b.$on("restaurants-changed",function(){c(function(){return s(b.deals)}),c(function(){return t(b.googleRestaurants)})}),b.$watch("deals",function(a){a&&c(function(){return s(a)})}),b.$watch("googleRestaurants",function(a){a&&c(function(){return t(a)})}),b.$watch("addonsFetched",function(a){a&&a>0&&(b.addonsFetched=0,l.loading(!1),l.hide())});var u=function(a){var d=a.venue.data.geocode.geometry.location.lat,f=a.venue.data.geocode.geometry.location.lng;$(".addons-list-col").css("height",$(n).height()-108),i.create(g,{lat:d,lng:f,name:a.event.eventVenue,street:a.venue.data.Street1,city:a.event.eventCity,state:a.event.eventState}),e.fetchDeals({lat:d,lng:f},function(a,d){c(function(){b.$apply(function(){b.deals=d,b.addonsFetched++})})})},v=function(e){var g={};"yipit"!==e.service&&(g.receipt={"not-available":!0}),f.fetch("plan.addRestaurant",{service:e.service,eventId:d.get().event.eventId,restaurant:e,total:0,payment:JSON.stringify(g)},function(d,f){if(console.log("added restaurant:"),console.log(f),e._id=f.restaurant._id,e.inPlan=!0,b.currentDeal=e,"split-first"===b.plan.preferences.payment)b.restaurantConfirm=!0,l.show();else{c(function(){a.$apply(function(){b.buyDealOffsite=!0,l.show()})},1500)}})};b.addDeal=function(a){var c=b.deals[a];console.log(c),delete c.$$hashKey,v(c)},b.addGoogleRestaurant=function(a){var c=b.googleParking[a];delete c.$$hashKey,h.getDetails(c.reference,function(a,d){d==google.maps.places.PlacesServiceStatus.OK&&b.$apply(function(){b.parkingDetails=a,addParking(c)})})},b.removeDeal=function(c){if("undefined"==typeof c)var c=b.currentDeal._id;return c?void d.removeRestaurant({restaurantId:c},function(c,e){b.currentDeal&&delete b.currentDeal,b.buyDealOffsite&&(b.buyDealOffsite=!1,l.hide()),b.restaurantConfirm&&(b.restaurantConfirm=!1,l.hide()),console.log(e),d.setRestaurants(e.restaurants),a.$broadcast("restaurants-changed")}):(b.restaurantConfirm=!1,b.buyDealOffsite=!1,void l.hide())},b.boughtDeal=function(){return"undefined"==typeof b.deal?void(n.location.href=b.nextLink):void d.addRestaurantReceipt({restaurantId:b.currentDeal._id,service:b.currentDeal.service,receipt:{qty:b.currentDeal.selectedQty,amountPaid:b.currentDeal.amountPaid}},function(){o.trackEvent("Plan","boughtDeal",b.plan.event.eventName,"",function(){n.location.href=b.nextLink})})},a.$on("overlay-clicked",function(){b.removeDeal(b.currentDeal._id)}),d.get(function(c){if(b.context=d.getContext()||"visitor",b.backToPlan=!1,null!==c.organizer.rsvp.decision&&(b.backToPlan=!0),b.nextLink=b.backToPlan?"/plan/cart":"/event-options/"+c.event.eventId+"/"+c.event.eventName,b.nextText=b.backToPlan?"Ok, Back To Plan Dashboard":"Continue To Plan Preferences","/plan/cart"===b.nextLink&&"organizer"!==d.getContext()&&(b.nextLink="/plan/vote"),g.isDrawn())u(c);else var e=a.$on("google-map-drawn",function(){u(c),e()})})}]).controller("ParkingCtrl",["$rootScope","$scope","$timeout","plan","wembliParking","wembliRpc","googleMap","googlePlaces","mapVenue","mapMarker","mapInfoWindowContent","overlay","$location","$window","googleAnalytics","header",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){p.fixed(),g.init(),b.currentPath=m.path(),b.parkingFetched=0,b.notFound=!0,b.filteredList=!1,b.determineRange=function(a){var b=parseFloat(a);return 20>=b?"$":b>20&&50>=b?"$$":b>50?"$$$":void 0},b.determineDistance=function(a){return parseFloat(a/5280).toFixed(2)};var q=function(){c(function(){b.$apply(function(){for(var a=0;a<b.googleParking.length;a++)b.googleParking[a].hide=!1;for(var a=0;a<b.parkingReservations.parking_listings.length;a++)b.parkingReservations.parking_listings[a].hide=!1;b.filteredList=!1})})};b.filterNone=q;var r=function(a){return"undefined"==typeof a?q():void b.$apply(function(){for(var c=0;c<b.googleParking.length;c++)b.googleParking[c].hide=b.googleParking[c].id!=a;for(var c=0;c<b.parkingReservations.parking_listings.length;c++)b.parkingReservations.parking_listings[c].hide=!0;b.filteredList=!0})},s=function(a){return"undefined"==typeof a?q():void b.$apply(function(){for(var c=0;c<b.parkingReservations.parking_listings.length;c++)b.parkingReservations.parking_listings[c].hide=b.parkingReservations.parking_listings[c].listing_id!=a;for(var c=0;c<b.googleParking.length;c++)b.googleParking[c].hide=!0;b.filteredList=!0})},t=function(a){b.notFound=!1,"undefined"!=typeof a&&angular.forEach(a.parking_listings,function(a,b){a.service="pw",a.hide="undefined"==typeof a.hide?!1:a.hide,a.parkingInPlan=!1;var c=d.getParking();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"pw"===e.parking.service&&e.parking.listing_id==a.listing_id&&(a._id=e._id,a.purchased=e.purchased,a.parkingInPlan=!0)}g.hasMarker(a.lat,a.lng)||j.create(g,{icon:"/images/icons/map-icons/transportation/parkinggarage.png",lat:a.lat,lng:a.lng,name:a.location_name,body:a.address+", "+a.city,click:{on:function(){s(a.listing_id)},off:function(){s()}}})})},u=function(a){b.notFound=!1,"undefined"!=typeof a&&angular.forEach(a,function(a,b){a.service="google",a.hide="undefined"==typeof a.hide?!1:a.hide,a.parkingInPlan=!1;var c=d.getParking();if("undefined"!=typeof c&&"undefined"!=typeof c[0])for(var b=0;b<c.length;b++){var e=c[b];"google"===e.parking.service&&e.parking.id==a.id&&(a._id=e._id,a.parkingInPlan=!0)}g.hasMarker(a.geometry.location.lat(),a.geometry.location.lng())||j.create(g,{icon:"/images/icons/map-icons/transportation/parkinggarage.png",position:a.geometry.location,name:a.name,body:a.vicinity,click:{on:function(){r(a.id)},off:function(){r()}}})})};b.$on("parking-changed",function(){c(function(){return t(b.parkingReservations)}),c(function(){return u(b.googleParking)})}),b.$watch("parkingReservations",function(a){a&&c(function(){return t(a)})}),b.$watch("googleParking",function(a){a&&c(function(){return u(a)})}),b.$watch("parkingFetched",function(a){a&&a>1&&(b.parkingFetched=0,l.loading(!1),l.hide())});var v=function(a){var d=a.venue.data.geocode.geometry.location.lat,f=a.venue.data.geocode.geometry.location.lng;$("#parking-list > div").css("height",$(n).height()-108),i.create(g,{lat:d,lng:f,name:a.event.eventVenue,street:a.venue.data.Street1,city:a.event.eventCity,state:a.event.eventState}),e.fetchGoogleParking({lat:d,lng:f},function(a,c){b.$apply(function(){b.googleParking=c,b.parkingFetched++})}),e.fetchParkingReservations({lat:d,lng:f},function(a,d){c(function(){b.$apply(function(){b.parkingReservations=d,b.parkingFetched++})})})},w=function(e){var g={};"pw"!==e.service&&(g.receipt={"not-available":!0}),f.fetch("plan.addParking",{service:e.service,eventId:d.get().event.eventId,parking:e,total:0,payment:JSON.stringify(g)},function(d,f){if(e._id=f.parking._id,e.parkingInPlan=!0,b.currentParking=e,console.log("parking is now current: "),console.log(b.currentParking),"split-first"===b.plan.preferences.payment)b.parkingConfirm=!0,l.show();else if("pw"===e.service){c(function(){a.$apply(function(){b.buyParkingOffsite=!0,l.show()})},1500)}else b.parkingConfirm=!0,l.show()})};b.addParkingReservations=function(a){var c=b.parkingReservations.parking_listings[a];console.log("add parking res: "),console.log(c),delete c.$$hashKey,w(c)},b.addGoogleParking=function(a){var c=b.googleParking[a];delete c.$$hashKey,h.getDetails(c.reference,function(a,d){d==google.maps.places.PlacesServiceStatus.OK&&b.$apply(function(){b.parkingDetails=a,w(c)})})},b.removeParking=function(c){return"undefined"==typeof c&&(c=b.currentParking._id),c?void d.removeParking({parkingId:c},function(c,e){b.currentParking&&delete b.currentParking,b.parkingDetails&&delete b.parkingDetails,b.buyParkingOffsite&&(b.buyParkingOffsite=!1,l.hide()),b.parkingConfirm&&(b.parkingConfirm=!1,l.hide()),d.setParking(e.parking),a.$broadcast("parking-changed",{parking:e.parking})}):(b.parkingConfirm=!1,b.buyParkingOffsite=!1,void l.hide())},b.boughtParking=function(){return"undefined"==typeof b.currentParking?void(n.location.href=b.nextLink):void d.addParkingReceipt({parkingId:b.currentParking._id,service:b.currentParking.service,receipt:{qty:b.currentParking.selectedQty,amountPaid:b.currentParking.amountPaid}},function(){o.trackEvent("Plan","boughtParking",b.plan.event.eventName,"",function(){n.location.href=b.nextLink})})},a.$on("overlay-clicked",function(){b.removeParking(b.currentParking._id)}),d.get(function(c){if(b.context=d.getContext()||"visitor",b.backToPlan=!1,null!==c.organizer.rsvp.decision&&(b.backToPlan=!0),b.nextLink=b.backToPlan?"/plan/cart":"/event-options/"+c.event.eventId+"/"+c.event.eventName,b.nextText=b.backToPlan?"Ok, Back To Plan Dashboard":"Continue To Plan Preferences","/plan/cart"===b.nextLink&&"organizer"!==d.getContext()&&(b.nextLink="/plan/vote"),g.isDrawn())v(c);else var e=a.$on("google-map-drawn",function(){v(c),e()})})}]),angular.module("wembliApp.directives.addOns",[]).directive("addonsMap",["$rootScope","googleMap",function(a,b){return{restrict:"C",cache:!1,replace:!0,compile:function(){return function(a,c,d){var e=d.mapTypeId?google.maps.MapTypeId[d.mapTypeId]:google.maps.MapTypeId.ROADMAP,f={mapTypeId:e};f.center=new google.maps.LatLng(d.lat,d.lng),d.zoom&&(f.zoom=parseInt(d.zoom)),d.draggable&&(f.draggable=d.draggable),b.draw(c,f)}}}}]),angular.module("wembliApp.services.addOns",[]).factory("wembliParking",["wembliRpc","googlePlaces",function(a,b){var c=this;return c.googleParking=null,c.parkingReservations=null,{getGoogleParking:function(){return c.googleParking},getParkingReservations:function(){return c.parkingReservations},setGoogleParking:function(a){c.googleParking=a},setParkingReservations:function(a){c.parkingReservations=a},fetchGoogleParking:function(a,d){a.radius=a.radius||5e3,b.getParking(a.lat,a.lng,a.radius,function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&(c.googleParking=a),d(null,c.googleParking)})},fetchParkingReservations:function(b,d){a.fetch("event.getParking",{lat:b.lat,lng:b.lng,radius:b.radius},function(a,b){return a?void alert("error happened - contact help@wembli.com"):("undefined"!=typeof b.parking&&(c.parkingReservations=b.parking),void d(null,c.parkingReservations))})}}}]).factory("wembliRestaurants",["wembliRpc","googlePlaces",function(a,b){var c=this;return c.googleRestaurants=null,c.deals=null,{getGoogleRestaurants:function(){return c.googleRestaurants},getDeals:function(){return c.deals},setGoogleRestaurants:function(a){c.googleRestaurants=a},setDeals:function(a){c.deals=a},fetchGoogleRestaurants:function(a,d){a.radius=a.radius||5e3,b.getRestaurants(a.lat,a.lng,a.radius,function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&(c.googleRestaurants=a),d(null,c.googleRestaurants)})},fetchDeals:function(b,d){a.fetch("event.getRestaurantDeals",{lat:b.lat,lng:b.lng,radius:b.radius},function(a,b){return a?void alert("error happened - contact help@wembli.com"):("undefined"!=typeof b.deals&&(c.deals=b.deals),void d(null,c.deals))})}}}]).factory("wembliHotels",["wembliRpc","googlePlaces",function(a,b){var c=this;return c.googleHotels=null,c.expediaHotels=null,{getGoogleHotels:function(){return c.googleHotels},getExpediaHotels:function(){return c.expediaHotels},setGoogleHotels:function(a){c.googleHotels=a},setExpediaHotels:function(a){c.expediaHotels=a},fetchGoogleHotels:function(a,d){a.radius=a.radius||5e3,b.getHotels(a.lat,a.lng,a.radius,function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&(c.googleHotels=a),d(null,c.googleHotels)})},fetchExpediaHotels:function(b,d){a.fetch("event.getHotels",{lat:b.lat,lng:b.lng,radius:b.radius},function(a,b){return a?void alert("error happened - contact help@wembli.com"):("undefined"!=typeof b.hotels&&(c.expediaHotels=b.hotels),void d(null,c.expediaHotels))})}}}]),angular.module("wembliApp.services.google",[]).factory("googleMap",["$rootScope",function(a){function b(a,b){return Math.abs(a-b)<1e-6}var c=this;c._markers=[],c._infoWindows=[],c._map=null,c.drawn=!1,c.dragging=!1,c.zoom=14,c.center=new google.maps.LatLng(32.722439302963,-117.1645658798);var d={center:c.center,zoom:c.zoom,draggable:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};return{init:function(){c._markers=[],c._infoWindows=[],c._map=null,c.drawn=!1,c.dragging=!1,c.zoom=14,c.center=new google.maps.LatLng(32.722439302963,-117.1645658798)},draw:function(b,e,f){var g=angular.extend(d,e),h=g.center.lat(),i=g.center.lng();g.center=new google.maps.LatLng(h,i),c._map=new google.maps.Map(b[0],g),google.maps.event.addListener(c._map,"dragstart",function(){c.dragging=!0}),google.maps.event.addListener(c._map,"idle",function(){c.dragging=!1}),google.maps.event.addListener(c._map,"drag",function(){c.dragging=!0}),google.maps.event.addListener(c._map,"zoom_changed",function(){c.zoom=c._map.getZoom(),c.center=c._map.getCenter()}),google.maps.event.addListener(c._map,"center_changed",function(){c.center=c._map.getCenter()}),"undefined"!=typeof f&&f.length&&angular.forEach(f,function(a){google.maps.event.addListener(c._map,a.on,a.handler)}),c.drawn=!0,a.$broadcast("google-map-drawn")},isDrawn:function(a){return"undefined"!=typeof a&&(c.drawn=a),c.drawn},getMap:function(){return c._map},addMarker:function(a){return c._markers.unshift(a),a},findMarker:function(a,d){for(var e=0;e<c._markers.length;e++){var f=c._markers[e].getPosition();if(b(f.lat(),a)&&b(f.lng(),d))return c._markers[e]}return null},hasMarker:function(a,b){return null!==this.findMarker(a,b)},removeMarker:function(){},addInfoWindow:function(a,b){var d={infoWindow:a,open:!1};if("undefined"!=typeof a&&"undefined"!=typeof b&&"undefined"!=typeof a.getPosition()&&"undefined"!=typeof b.getPosition())return"undefined"!=typeof b&&"undefined"!=typeof b.getPosition()?(d.lat=b.getPosition().lat(),d.lng=b.getPosition().lng()):(d.lat=a.getPosition().lat(),d.lng=a.getPosition().lng()),c._infoWindows.unshift(d),d},_findInfoWindow:function(a,d){for(var e=0;e<c._infoWindows.length;e++){var f=c._infoWindows[e].lat,g=c._infoWindows[e].lng;if(b(f,a)&&b(g,d))return c._infoWindows[e]}return null},findInfoWindow:function(a,b){var c=this._findInfoWindow(a,b);return c?c.infoWindow:null},isInfoWindowOpen:function(a){var b=a.getPosition().lat(),c=a.getPosition().lng(),d=this._findInfoWindow(b,c);return d?d.open:!1},closeInfoWindow:function(a){var b=a.getPosition().lat(),c=a.getPosition().lng(),d=this._findInfoWindow(b,c);d.open=!1,d.infoWindow.close()},openInfoWindow:function(a){var b=a.getPosition().lat(),d=a.getPosition().lng(),e=this._findInfoWindow(b,d);e&&(e.open=!0,e.infoWindow.open(c._map,a))},resize:function(){google.maps.event.trigger(c._map,"resize"),a.$broadcast("google-map-resize")}}}]).factory("googlePlaces",["googleMap",function(a){return{getParking:function(b,c,d,e){var f={location:new google.maps.LatLng(b,c),radius:d,types:["parking"]},g=new google.maps.places.PlacesService(a.getMap());g.nearbySearch(f,e)},getRestaurants:function(b,c,d,e){var f={location:new google.maps.LatLng(b,c),radius:d,types:["restaurant"]},g=new google.maps.places.PlacesService(a.getMap());g.nearbySearch(f,e)},getHotels:function(b,c,d,e){var f={location:new google.maps.LatLng(b,c),radius:d,types:["lodging"]},g=new google.maps.places.PlacesService(a.getMap());g.nearbySearch(f,e)},getDetails:function(b,c){var d={reference:b},e=new google.maps.places.PlacesService(a.getMap());e.getDetails(d,c)}}}]).factory("mapMarker",["mapInfoWindowContent",function(a){return{create:function(b,c){var d,e={map:b.getMap()};"undefined"!=typeof c.position&&(d=c.position),"undefined"!=typeof c.lat&&"undefined"!=typeof c.lng&&(d=new google.maps.LatLng(c.lat,c.lng)),e.position=d;var f=new google.maps.Marker(e);f.setIcon(c.icon),f.setAnimation(google.maps.Animation.DROP);var g=new google.maps.InfoWindow({position:d,content:a.create({header:c.name,body:c.body}),pixelOffset:new google.maps.Size(10,0)});google.maps.event.addListener(f,"click",function(){b.isInfoWindowOpen(f)?b.closeInfoWindow(f):b.openInfoWindow(f)}),"undefined"!=typeof c.click&&google.maps.event.addListener(f,"click",function(){b.isInfoWindowOpen(f)?c.click.on():c.click.off()}),b.addMarker(f),b.addInfoWindow(g,f)}}}]).factory("mapVenue",["mapInfoWindowContent",function(a){return{create:function(b,c){var d;"undefined"!=typeof c.position&&(d=c.position),"undefined"!=typeof c.lat&&"undefined"!=typeof c.lng&&(d=new google.maps.LatLng(c.lat,c.lng));var e=new google.maps.Marker({map:b.getMap(),position:d});e.setIcon("/images/icons/map-icons/sports/stadium.png"),e.setAnimation(google.maps.Animation.DROP);var f=new google.maps.InfoWindow({position:d,content:a.create({header:c.name,body:c.street+", "+c.city+", "+c.state}),pixelOffset:new google.maps.Size(10,0)});google.maps.event.addListener(e,"click",function(){b.isInfoWindowOpen(e)?b.closeInfoWindow(e):b.openInfoWindow(e)}),b.addMarker(e),b.addInfoWindow(f,e),b.openInfoWindow(e)}}}]).factory("mapInfoWindowContent",[function(){return{create:function(a){var b='<div class="info-window">';return b+='<h3 class="info-window-header">'+a.header+"</h3>",b+='<div class="info-window-body">'+a.body+"</div>",b+="</div>"}}}]);