/*! wembli-website 2014-06-21 */
"use strict";

angular.module("wembliApp", [ "ngRoute", "mgcrea.ngStrap", "wembliApp.controllers", "wembliApp.controllers.eventOptions", "wembliApp.controllers.header", "wembliApp.filters", "wembliApp.services", "wembliApp.services.header", "wembliApp.services.facebook", "wembliApp.services.twitter", "wembliApp.services.pixel", "wembliApp.directives", "wembliApp.directives.header" ]).config([ "$routeProvider", "$locationProvider", function() {} ]).run([ "$timeout", "initRootScope", "$rootScope", "$location", "$route", "$window", "facebook", "twitter", "plan", "wembliRpc", function($timeout, initRootScope, $scope, $location, $route, $window, facebook, twitter, plan) {
    console.log("run event-options angular app"), $timeout(function() {
        plan.fetch(function() {});
    }), $window.fbAsyncInit = function() {
        facebook.getLoginStatus(), $scope.facebook = facebook;
    }, twitter.getLoginStatus();
} ]), angular.module("wembliApp.controllers.eventOptions", []).controller("EventOptionsCtrl", [ "$scope", "wembliRpc", "$window", "plan", function($scope, wembliRpc, $window, plan) {
    $scope.addOnsError = !1, $scope.inviteOptionsError = !1, $scope.guestListOptionsError = !1, 
    $scope.submitInProgress = !1, plan.get(function(p) {
        "undefined" == typeof $scope.next && ($scope.next = "/invitation/" + p.event.eventId + "/" + p.event.eventName), 
        wembliRpc.fetch("event-options.init", {}, function(err, result) {
            $scope.parking = result.parking, $scope.restaurant = result.restaurant, $scope.hotel = result.hotel, 
            $scope.guest_friends = result.guestFriends, $scope.organizer_not_attending = result.organizerNotAttending, 
            $scope.guest_list = result.guestList, $scope.over_21 = result.over21, Object.keys(result.errors).length > 0 && ($scope.addOnsError = result.errors.addOns ? !0 : !1, 
            $scope.inviteOptionsError = result.errors.inviteOptions ? !0 : !1, $scope.guestListOptionsError = result.errors.guestList ? !0 : !1);
        });
    }), $scope.submitForm = function() {
        var eventOptions = {};
        eventOptions.parking = $scope.parking, eventOptions.restaurant = $scope.restaurant, 
        eventOptions.hotel = $scope.hotel, eventOptions.guest_friends = $scope.guest_friends, 
        eventOptions.organizer_not_attending = $scope.organizer_not_attending, eventOptions.guest_list = $scope.guest_list, 
        eventOptions.over_21 = $scope.over_21, $scope.submitInProgress = !0, wembliRpc.fetch("event-options.submit", eventOptions, function(err, result) {
            $scope.submitInProgress = !1, err && ($scope.error = !0, $scope.errorMessage = err), 
            result.success || ($scope.error = !0, $scope.errorMessage = result.errorMessage), 
            result.success && ($window.location.href = $scope.next);
        });
    };
} ]);